<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨</title>
    <style>
      /* =========== Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ =========== */
      body {
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #2c3e50, #4ca1af);
        color: #f5f5f5;
        padding: 20px;
        max-width: 800px;
        margin: auto;
        line-height: 1.5;
      }

      /* =========== Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† =========== */
      h2,
      h3 {
        text-align: center;
        font-weight: bold;
        margin: 15px 0;
      }
      h2 {
        font-size: 1.3rem;
        color: #fffae3;
      }
      h3 {
        font-size: 1.1rem;
        color: #fffae3;
      }

      /* =========== Ø§Ù„Ù„ÙŠÙ†ÙƒØ§Øª =========== */
      a {
        color: #fffa90;
        text-decoration: none;
        font-weight: bold;
        transition: color 0.3s, text-decoration 0.3s;
      }
      a:hover {
        text-decoration: underline;
        color: #ffe97f;
      }

      /* =========== Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø© =========== */
      #addAgentContainer,
      .form-container {
        margin: 25px auto;
        padding: 20px;
        background-color: rgba(255, 255, 255, 0.08);
        border-radius: 6px;
        box-shadow: 0px 4px 15px rgba(255, 255, 255, 0.1);
      }

      /* =========== Ø§Ù„ÙÙˆØ±Ù… Ø¹Ù„Ù‰ Ø³Ø·Ø±ÙŠÙ† =========== */
      .form-row {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 20px;
      }
      .form-group {
        flex: 1 1 48%;
        display: flex;
        flex-direction: column;
        margin-bottom: 15px;
      }
      label {
        font-size: 0.9rem;
        font-weight: 600;
        margin-bottom: 5px;
        color: #fffae3;
      }
      select,
      input,
      button {
        padding: 9px 12px;
        font-size: 0.95rem;
        border-radius: 4px;
        border: none;
        outline: none;
        transition: box-shadow 0.3s;
      }
      select,
      input {
        width: 80%; /* Ù…Ø±ÙŠØ­ Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙŠØ³ÙƒØªÙˆØ¨ */
        margin-bottom: 20px;
      }
      select:focus,
      input:focus {
        box-shadow: 0px 0px 8px rgba(255, 250, 227, 0.5);
      }

      /* =========== Ø§Ù„Ø¬Ø¯ÙˆÙ„ =========== */
      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.9rem;
        margin: 20px 0;
        border-radius: 8px;
        overflow: hidden;
      }
      table thead {
        background-color: rgba(255, 255, 255, 0.15);
      }
      table th,
      table td {
        padding: 8px;
        text-align: center;
        border-bottom: 1px solid #888;
      }
      table tr:hover {
        background-color: rgba(255, 255, 255, 0.07);
      }

      /* =========== Ø§Ù„Ø£Ø²Ø±Ø§Ø± =========== */
      button {
        cursor: pointer;
        font-weight: bold;
        background-color: #fffae3;
        color: #2c3e50;
        margin: 5px 0;
        padding: 9px 15px;
        border-radius: 5px;
        transition: background-color 0.3s;
      }
      button:hover {
        background-color: #ffe97f;
      }

      /* =========== Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙˆØ­Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ« =========== */
      #uploadLoader {
        font-size: 14px;
        color: #ffe97f;
      }
      #addAgentAlert,
      #uploadStatus,
      #clearStatus {
        margin: 10px 0;
        padding: 8px;
        font-size: 13px;
        font-weight: bold;
        border-radius: 4px;
        text-align: center;
      }
      #addAgentAlert {
        display: none;
      }

      /* =========== Ù…ÙˆØ¨Ø§ÙŠÙ„ =========== */
      @media (max-width: 768px) {
        .form-group {
          flex: 1 1 100%; /* Ø¹Ù†ØµØ± ÙƒØ§Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø·Ø± Ø¹Ù„Ù‰ Ù…ÙˆØ¨Ø§ÙŠÙ„ */
        }
        select,
        input {
          width: 100%; /* Ù…Ø±ÙŠØ­ Ø¹Ù„Ù‰ Ù…ÙˆØ¨Ø§ÙŠÙ„ */
        }
      }
    </style>
  </head>
  <body>
    <!-- =========== Ø§Ù„Ù‡ÙŠØ¯Ø± =========== -->
    <header
      style="
        background: linear-gradient(45deg, #2c3e50, #4ca1af);
        padding: 15px 30px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        color: #fff;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.3);
        border-bottom-left-radius: 10px;
        border-bottom-right-radius: 10px;
      "
    >
      <div style="display: flex; align-items: center">
        <a href="./index.html"
          ><img
            src="./Orange_logo.svg.png"
            alt="Logo"
            style="height: 50px; margin-left: 15px; border-radius: 8px"
        /></a>
        <h2 style="margin: 0">ÙÙˆÙƒØ³ Ø¨ÙŠØ²Ù†ÙŠØ³</h2>
      </div>
      <div style="font-size: 16px; display: flex; gap: 20px">
        <a href="./management.html"><h2>Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨ â¬…</h2></a>
        <a href="./agents_performance.html"><h2>Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨ â¬…</h2></a>
        <a href="./dashboard.html"><h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â¬…</h2></a>
      </div>
    </header>
    <!-- Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†Ø¯ÙˆØ¨ØŒ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø³Ù…ØŒ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù -->
    <!-- <h2>Ø±ÙØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>
    <div class="form-container">
      <label for="agentSelect">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨:</label>
      <select id="agentSelect">
        <option value="">-- Ø§Ø®ØªØ± --</option>
      </select>
      <label for="sectionSelect">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…:</label>
      <select id="sectionSelect">
        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… --</option>
      </select>
      <label for="excelFile">Ù…Ù„Ù Excel:</label>
      <input type="file" id="excelFile" accept=".xls,.xlsx" />
      <button id="excelUploadButton">ğŸ“¤ Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
      <div id="uploadStatus"></div>
      <div id="uploadLoader" style="display: none">â³ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
    </div> -->
    <!-- Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯ -->

    <!-- =========================== Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†Ø¯ÙˆØ¨ =========================== -->
    <div id="adminAgentSelectContainer">
      <h3>ğŸ‘” Ø§Ø®ØªØ± Ù…Ù†Ø¯ÙˆØ¨ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„</h3>
      <select id="adminAgentSelect">
        <option value="">-- Ø§Ø®ØªØ± Ù…Ù†Ø¯ÙˆØ¨ --</option>
      </select>
    </div>

    <!-- =========================== Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ =========================== -->
    <table id="adminCustomersTable">
      <thead>
        <tr>
          <th>Ø§Ù„Ù‚Ø³Ù…</th>
          <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
          <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
          <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
          <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
          <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
          <th>Ø­ÙØ¸</th>
        </tr>
      </thead>

      <tbody></tbody>
    </table>

    <!-- =========== Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª =========== -->
    <h2>Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
    <button id="clearButton">ğŸ§¨ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    <div id="clearStatus"></div>

    <!-- =========== ÙÙˆØ±Ù… Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø¯ÙˆØ¨ =========== -->
    <div id="addAgentContainer">
      <h3>â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø¯ÙˆØ¨</h3>
      <div id="addAgentAlert"></div>
      <input id="newAgentName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨" />
      <input id="newAgentEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" />
      <input id="newAgentPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
      <select id="newAgentRole">
        <option value="agent">Ù…Ù†Ø¯ÙˆØ¨</option>
        <option value="admin">Ø£Ø¯Ù…Ù†</option>
      </select>
      <button id="addAgentButton">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø¯ÙˆØ¨</button>
    </div>

    <!-- =========== Ø§Ù„ÙÙˆØªØ± =========== -->
    <footer
      style="
        background: #2c3e50;
        color: #fff;
        text-align: center;
        padding: 15px;
        font-size: 14px;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
        margin-top: 40px;
      "
    >
      <div>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© &copy; ÙÙˆÙƒØ³ Ø¨ÙŠØ²Ù†ÙŠØ³</div>
      <div>Ù…Ø·ÙˆØ± Ø§Ù„Ù†Ø¸Ø§Ù…: Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ù‡Ø§Ù†ÙŠ</div>
      <div>Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡: 01212555345</div>
    </footer>

    <!-- =========== Ø§Ù„Ø¬Ø§ÙØ§ Ø³ÙƒØ±Ø¨Øª =========== -->
    <script type="module">
      import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

      const supabase = createClient(
        "https://vyhtsdqccyvygelekzey.supabase.co",
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5aHRzZHFjY3l2eWdlbGVremV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NTQwOTMsImV4cCI6MjA2NTMzMDA5M30.bRjHD6OkziXjfavEX-tA-6IFdag7KoFBqLRgNLqwcdg"
      );

      // =========== Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ===========
      window.addEventListener("load", async () => {
        await loadAgentsForAdmin();
        const adminAgentSelect = document.getElementById("adminAgentSelect");
        adminAgentSelect?.addEventListener("change", (e) => {
          if (e.target.value) {
            loadCustomersForAdmin(e.target.value);
          }
        });
      });

      // =========== ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ† Ù„Ù„Ù…Ø¯ÙŠØ± ===========
      async function loadAgentsForAdmin() {
        const select = document.getElementById("adminAgentSelect");
        if (!select) return;

        const { data: agents, error } = await supabase
          .from("agents")
          .select("*");
        if (error) {
          console.error(error);
          return;
        }

        select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ù…Ù†Ø¯ÙˆØ¨ --</option>';
        agents.forEach((agent) => {
          const option = document.createElement("option");
          option.value = agent.id;
          option.textContent = agent.name;
          select.appendChild(option);
        });
      }

      // =========== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆØªÙ‚Ø³ÙŠÙ…Ù‡Ù… Ø¹Ù„Ù‰ Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù… ===========
      async function loadCustomersForAdmin(agent_id) {
        const tableBody = document.querySelector("#adminCustomersTable tbody");
        tableBody.innerHTML = ""; // Ù…Ø³Ø­ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„ØªØ¹Ø¨Ø¦Ø©

        const { data: customers, error } = await supabase
          .from("customers")
          .select("*")
          .eq("agent_id", agent_id)
          .order("section", { ascending: true });

        if (error) {
          alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡");
          console.error(error);
          return;
        }

        if (!customers.length) {
          tableBody.innerHTML = '<tr><td colspan="7">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡</td></tr>';
          return;
        }

        const groupedCustomers = customers.reduce((acc, cust) => {
          const section = cust.section || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
          if (!acc[section]) acc[section] = [];
          acc[section].push(cust);
          return acc;
        }, {});

        for (const sectionName in groupedCustomers) {
          // Ø³Ø·Ø± Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‚Ø³Ù…
          const sectionRow = document.createElement("tr");
          sectionRow.innerHTML = `
      <td colspan="7" style="background-color:#34495e;color:#fff">
        ğŸ“ ${sectionName}
        <input value="${sectionName}" data-oldname="${sectionName}" class="editSectionInput" />
        <button class="saveSectionBtn" data-oldname="${sectionName}">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù‚Ø³Ù…</button>
        <button class="addCustomerToSectionBtn" data-section="${sectionName}">â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</button>
      </td>`;
          tableBody.appendChild(sectionRow);

          // Ø³Ø·ÙˆØ± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
          groupedCustomers[sectionName].forEach((cust) => {
            const row = document.createElement("tr");
            row.innerHTML = `
        <td>${cust.section}</td>
        <td><input value="${cust.name}" data-id="${
              cust.id
            }" data-field="name"/></td>
        <td><input value="${cust.phone}" data-id="${
              cust.id
            }" data-field="phone"/></td>
        <td><input value="${cust.address || ""}" data-id="${
              cust.id
            }" data-field="address"/></td>
        <td><input value="${cust.due_amount}" data-id="${
              cust.id
            }" data-field="due_amount" type="number"/></td>
        <td>
            <select data-id="${cust.id}" data-field="collection_status">
              <option ${
                cust.collection_status === "ØªÙ… Ø§Ù„ØªØ­ØµÙŠÙ„" ? "selected" : ""
              }>ØªÙ… Ø§Ù„ØªØ­ØµÙŠÙ„</option>
              <option ${
                cust.collection_status !== "ØªÙ… Ø§Ù„ØªØ­ØµÙŠÙ„" ? "selected" : ""
              }>Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ­ØµÙŠÙ„</option>
            </select>
        </td>
        <td>
            <button data-id="${cust.id}" class="saveCustomerBtn">ğŸ’¾ Ø­ÙØ¸</button>
            <button data-id="${
              cust.id
            }" class="deleteCustomerBtn">ğŸ—‘ï¸ Ø­Ø°Ù</button>
        </td>`;
            tableBody.appendChild(row);
          });
        }
      }

      // =========== Ø­ÙØ¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… ===========
      document
        .querySelector("#adminCustomersTable")
        ?.addEventListener("click", async (e) => {
          if (e.target.classList.contains("saveSectionBtn")) {
            const oldName = e.target.getAttribute("data-oldname");
            const newName = e.target
              .closest("tr")
              .querySelector(".editSectionInput")
              .value.trim();
            if (!newName) return alert("âŒ Ø¨Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯");

            const { error } = await supabase
              .from("customers")
              .update({ section: newName })
              .eq("section", oldName);

            if (error) {
              alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø³Ù…");
              console.error(error);
            } else {
              alert("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­");
              loadCustomersForAdmin(
                document.getElementById("adminAgentSelect").value
              );
            }
          }
        });

      // =========== Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ù„Ù‚Ø³Ù… Ù…Ø­Ø¯Ø¯ ===========
      document
        .querySelector("#adminCustomersTable")
        ?.addEventListener("click", async (e) => {
          if (e.target.classList.contains("addCustomerToSectionBtn")) {
            const section = e.target.getAttribute("data-section"); // âœ… Ù†Ø£Ø®Ø° Ø§Ù„Ù‚Ø³Ù… Ù…Ù† Ø§Ù„Ø¹Ù†ØµØ±
            const agent_id = document.getElementById("adminAgentSelect").value;

            const name = prompt(`ğŸ‘¤ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ù‚Ø³Ù… "${section}"`);
            const phone = prompt(`ğŸ“ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:`);
            const address = prompt(`ğŸ  Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„:`);
            const due_amount = parseFloat(prompt(`ğŸ’µ Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ­Ù‚:`));

            if (!name || !phone || !address || !due_amount) {
              alert("âŒ Ø¨Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
              return;
            }

            const { error } = await supabase.from("customers").insert([
              {
                agent_id,
                section,
                name,
                phone,
                address,
                due_amount,
                billing_month: new Date().toISOString().slice(0, 7),
                collection_status: "Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ­ØµÙŠÙ„",
              },
            ]);

            if (error) {
              alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„");
              console.error(error);
            } else {
              alert("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­");
              loadCustomersForAdmin(agent_id);
            }
          }

          // =========== Ø­ÙØ¸ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ===========
          document
            .querySelector("#adminCustomersTable")
            ?.addEventListener("click", async (e) => {});

          if (e.target.classList.contains("saveCustomerBtn")) {
            const id = e.target.getAttribute("data-id");
            const inputs = document.querySelectorAll(`[data-id="${id}"]`);

            const updatedData = {};
            inputs.forEach((input) => {
              updatedData[input.getAttribute("data-field")] =
                input.value.trim();
            });
            if (updatedData.due_amount) {
              updatedData.due_amount = Number(updatedData.due_amount);
            }

            const { error } = await supabase
              .from("customers")
              .update(updatedData)
              .eq("id", id);
            if (error) {
              alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª");
              console.error(error);
            } else {
              alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­");
            }
          }
        });

      // =========== Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ ===========
      document
        .querySelector("#adminCustomersTable")
        ?.addEventListener("click", async (e) => {
          if (e.target.classList.contains("deleteCustomerBtn")) {
            const id = e.target.getAttribute("data-id");
            if (!confirm("â“ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ")) return;

            const { error } = await supabase
              .from("customers")
              .delete()
              .eq("id", id);
            if (error) {
              alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù");
              console.error(error);
            } else {
              alert("âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­");
              loadCustomersForAdmin(
                document.getElementById("adminAgentSelect").value
              );
            }
          }
        });
    </script>
  </body>
</html>
