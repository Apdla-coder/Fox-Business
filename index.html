<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>تسجيل الدخول</title>
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#2c3e50" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />

    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #2c3e50, #4ca1af);
        height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }

      .login-container {
        background: #ffffff;
        padding: 30px 40px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        width: 350px;
        text-align: center;
        margin: 50px auto;
      }

      h1 {
        margin-bottom: 25px;
        color: #333;
      }

      input {
        width: 100%;
        padding: 12px;
        margin-bottom: 20px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 14px;
      }

      button {
        width: 100%;
        padding: 12px;
        background: #3498db;
        color: white;
        font-size: 16px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.3s ease;
      }

      button:hover {
        background: #2980b9;
      }

      .alert {
        background-color: #f8d7da;
        color: #721c24;
        padding: 10px;
        margin-bottom: 15px;
        border-radius: 5px;
        font-size: 14px;
        display: none;
      }
    </style>

    <script type="module">
      import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

      const supabase = createClient(
        "https://vyhtsdqccyvygelekzey.supabase.co",
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5aHRzZHFjY3l2eWdlbGVremV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NTQwOTMsImV4cCI6MjA2NTMzMDA5M30.bRjHD6OkziXjfavEX-tA-6IFdag7KoFBqLRgNLqwcdg"
      );

      window.login = async function () {
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value;
        const alertBox = document.getElementById("alertBox");

        if (!email || !password) {
          alertBox.innerText = "من فضلك أدخل البريد وكلمة المرور";
          alertBox.style.display = "block";
          return;
        }

        try {
          const { data, error } = await supabase
            .from("agents")
            .select("*")
            .eq("email", email)
            .eq("password", password)
            .single();

          if (error || !data) {
            alertBox.innerText = "بيانات الدخول غير صحيحة";
            alertBox.style.display = "block";
            return;
          }

          localStorage.setItem("agent_id", data.id);
          localStorage.setItem("role", data.role);

          await supabase.from("login_logs").insert([{ agent_id: data.id }]);

          setTimeout(() => {
            if (data.role === "admin") {
              window.location.href = "dashboard.html";
            } else {
              window.location.href = "collections.html";
            }
          }, 300);
        } catch (err) {
          alertBox.innerText = "حدث خطأ غير متوقع، حاول لاحقاً";
          alertBox.style.display = "block";
          console.error(err);
        }
      };
    </script>
  </head>
  <body>
    <!-- ✅ الهيدر -->
    <header
      style="
        background: linear-gradient(45deg, #2c3e50, #4ca1af);
        padding: 15px 30px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        color: #fff;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        border-bottom-left-radius: 10px;
        border-bottom-right-radius: 10px;
      "
    >
      <div style="display: flex; align-items: center">
        <img
          src="./Orange_logo.svg.png"
          alt="Logo"
          style="height: 50px; margin-left: 15px; border-radius: 8px"
        />
        <h2 style="margin: 0">فوكس بيزنيس</h2>
      </div>
      <div style="font-size: 16px">نظام إدارة التحصيل</div>
    </header>

    <!-- ✅ فورم تسجيل الدخول -->
    <div class="login-container">
      <h1>تسجيل الدخول</h1>
      <div class="alert" id="alertBox"></div>
      <input type="email" id="email" placeholder="البريد الإلكتروني" />
      <input type="password" id="password" placeholder="كلمة المرور" />
      <button onclick="login()">دخول</button>
    </div>

    <!-- ✅ الفوتر -->
    <footer
      style="
        background: #2c3e50;
        color: #fff;
        text-align: center;
        padding: 15px;
        font-size: 14px;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.15);
      "
    >
      <div>جميع الحقوق محفوظة &copy; فوكس بيزنيس</div>
      <div>مطور النظام: عبدالله هاني</div>
      <div>خدمة العملاء: 01212555345</div>
    </footer>
  </body>
</html>
